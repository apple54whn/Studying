# 1 数据库简介

- 数据库就是用来**存储和管理**数据的仓库
- 数据库管理系统（DBMS，数据的仓库）的概述
  - 方便查询；可存储的数据量大；保证数据的完整、一致；安全可靠
  - RDBMS（关系型数据库管理系统）使用表格存储数据
- 常见数据库
  - Oracle（神喻）：甲骨文（最高！）
  - **MySQL**：甲骨文
  - SQL Server：微软
  - DB2：IBM
  - Sybase：赛尔斯
- **RDBMS** = 管理员（**manager**）+仓库（**database**）
  - database = N个**table**
    - **表结构**：定义表的列名和列类型
    - **表记录**：一行一行的记录
- **MySQL重要文件夹**
  - C:\Program Files\MySQL\MySQL Server 8.0：**DBMS管理程序**
  - C:\ProgramData\MySQL\MySQL Server 8.0\data：**DBMS数据库文件**（卸载MySQL时不会删除这个目录）
    - 每个目录表示一个数据库，，每个数据库目录下会有0~N个扩展名为frm的table文件
- **MySQL重要文件**
  - C:\Program Files\MySQL\MySQL Server 8.0\bin\ **mysqld**.exe：**服务器程序**，必须先启动它
  - C:\Program Files\MySQL\MySQL Server 8.0\bin\ **mysql**.exe：**客户端程序**操作服务器，服务器必须先开启
  - D:\Program Files\MySQL\MySQL Server 5.1\bin\ **my.ini**：**服务器配置文件**
    - 配置MySQL的端口：默认为3306，没有必要去修改它；
    - 配置字符编码：
      - [client]下配置客户端编码：default-character-set=gbk
      - [mysqld]下配置服务器编码：character-set-server=utf8
    - 配置二进制数据大小上限：
      - 在[mysqld]下配置：max_allowed_packet=8M
- **服务器操作**
  - 开启服务器(必须保证mysql为windows服务)：**net start mysql**，mysqld.exe进程存在
  - 关闭服务器(必须保证mysql为windows服务)：**net stop mysql**，mysqld.exe进程不存在
- **客户端操作**
  - 登录服务器：**mysql -uroot -p123 -hlocalhost**
  - 退出服务器：**exit或quit**



# 2 SQL

* **结构化查询语言**(Structured Query Language)

  * 作用：**客户端使用SQL来操作服务器**

* **SQL语法**

  * SQL语句可以在**单行或多行**书写，以**分号结尾**
  * 可使用空格和缩进来增强语句的可读性
  * MySQL不区别大小写，**建议使用大写**

* SQL语句**分类**

  * **DDL**（Data Definition Language）：**数据定义语言**

    数据库或表的**结构**操作，创建、删除、修改：库、表结构

  * **DML**（Data Manipulation Language）：**数据操作语言**

    对表的**记录**进行更新（增、删、改）

  * **DQL**（Data Query Language）：**数据查询语言**，用来查询记录数据

  * DCL（Data Control Language）：数据控制语言，用来对用户的创建，及授权

## 2.1 DDL

### 2.1.1 数据库(DATABASE)

* <span style="color:red;font-weight:bold">创建数据库(CREATE DATABASE)</span>

  ```mysql
  CREATE DATABASE [IF NOT EXISTS] mydb1 [CHARSET=utf8];
  ```

* <span style="color:red;font-weight:bold">删除数据库(DROP DATABASE)</span>

  ```mysql
  DROP DATABASE [IF EXISTS] mydb1;
  ```

* <span style="color:red;font-weight:bold">查看所有数据库(SHOW DATABASES)</span>

  ```mysql
  SHOW DATABASES;
  ```

* <span style="color:red;font-weight:bold">切换数据库(USE 数据库名)</span>

  ```mysql
  USE 数据库名;
  ```

* 修改数据库编码

  ```mysql
  ALTER DATABASE mydb1 CHARACTER SET utf8;
  ```

### 2.1.2 数据类型(列类型)

* **int**：整型

  **double**：浮点型，例如double(5,2)表示最多5位，其中必须有2位小数，即最大值为999.99；

  **decimal**：浮点型，在表示钱方面使用该类型，因为不会出现精度缺失问题；

  **char**：固定长度字符串类型； char(255)，数据的长度不足指定长度，补空格到指定长度！

  **varchar**：可变长度字符串类型； varchar(65535)

* text(clob)：**字符串类型**；tinytext(2^8-1B)、text(2^16-1B)、mediumtext(2^24-1B)、longtext(2^32-1B)

  blob：**字节类型**；tinytext(2^8-1B)、text(2^16-1B)、mediumtext(2^24-1B)、longtext(2^32-1B)

* 在数据库中所有的字符串类型，必须使用**单引**，不能使用双引;日期类型也要使用单引！

### 2.1.3 表(TABLE)

* <span style="color:red;font-weight:bold">创建表(CREATE TABLE)</span>

  ```mysql
  CREATE TABLE [IF NOT EXISTS] 表名(
    列名 列类型,
    列名 列类型,
    ...
    列名 列类型
  );
  ```

* <span style="color:red;font-weight:bold">删除表(DROP TABLE)</span>

  ```mysql
  DROP TABLE 表名;
  ```

* <span style="color:red;font-weight:bold">查看当前数据库中所有表名称(SHOW TABLES)</span>

  ```mysql
  SHOW TABLES;
  ```

  <span style="color:red;font-weight:bold">查看表结构(DESC)</span>

  ```mysql
  DESC 表名;
  ```

  查看指定表的创建语句(了解)

  ```mysql
  SHOW CREATE TABLE 表名;
  ```

* <span style="color:red;font-weight:bold">修改表</span>：前缀：<span style="color:red;font-weight:bold">ALTER TABLE 表名</span>

  * 修改<span style="color:red;font-weight:bold">表名称(RENAME TO</span>)

    ```mysql
    ALTER TABLE 原表名 RENAME TO 新表名;
    ```

  * 修改之<span style="color:red;font-weight:bold">添加列(ADD)</span>

    ```mysql
    ALTER TABLE 表名 ADD (
        列名 列类型,
        列名 列类型,
        ...
    );
    ```

  * 修改之<span style="color:red;font-weight:bold">删除列(DROP)</span>

    ```mysql
    ALTER TABLE 表名 DROP 列名;
    ```

  * 修改之<span style="color:red;font-weight:bold">修改列名类型(CHANGE)</span>

    ```mysql
    ALTER TABLE 表名 CHANGE 原列名 新列名 列类型;//新的类型可能会影响到已存在数据
    ```

  * 修改之<span style="color:red;font-weight:bold">修改列类型(MODIFY)</span>

    ```mysql
    ALTER TABLE 表名 MODIFY 列名 列类型;//新的类型可能会影响到已存在数据
    ```

## 2.2 DML

* <span style="color:red;font-weight:bold">插入数据(INSERT INTO)</span>

  ```mysql
  INSERT INTO 表名(
      列名1,列名2, ...
  ) VALUES(列值1, 列值2, ...);
  //没有指定的列等同与插入null值,插入记录总是插入一行
  ```

  ```mysql
  INSERT INTO 表名 
  VALUES(列值1, 列值2);
  //插入所有列。值的顺序，必须与表创建时给出的列的顺序相同
  ```

* <span style="color:red;font-weight:bold">删除数据(DELETE FROM)</span>

  ```mysql
  DELETE FROM 表名 [WHERE 条件];
  ```

* <span style="color:red;font-weight:bold">修改数据(UPDATE...SET)</span>

  ```mysql
  UPDATE 表名 SET 列名1=列值1, 列名2=列值2, ... [WHERE 条件]
  ```

  * **条件(可选的)**

    * 条件必须是一个boolean类型的值或表达式

    * 运算符：=、!=、<>、>、<、>=、<=、BETWEEN...AND、IN(...)、IS NULL、NOT、OR、AND

      ```mysql
      WHERE age >= 18 AND age <= 80
      WHERE age BETWEEN 18 AND 80
      WHERE name='zhangSan' OR name='liSi'
      WHERE name IN ('zhangSan', 'liSi')
      WHERE age IS NULL, 不能使用等号
      WHERE age IS NOT NULL
      ```

## 2.3 DQL

* <span style="color:red;font-weight:bold">查询不会修改数据库表记录！</span>
* <span style="color:red;font-weight:bold">顺序：SELECT、FROM、WHERE、GROUP BY、HAVING、ORDER BY</span>

### 2.3.1 基本查询

* <span style="color:red;font-weight:bold">字段(列)控制</span>

  * <span style="color:red;font-weight:bold">查询列(SELECT...FROM)</span>

    ```mysql
    SELECT * FROM 表名;//其中“*”表示查询所有列
    ```

    ```mysql
    SELECT 列1 [, 列2, ... 列N] FROM 表名;//查询指定列
    ```

  * 完全重复的<span style="color:red;font-weight:bold">记录只一次(DISTINCT</span>)

    ```mysql
    SELECT DISTINCT 列1 [, 列2, ... 列N]  FROM 表名;
    ```

  * <span style="color:red;font-weight:bold">列运算</span>

    * 数量类型的列可以做<span style="color:red;font-weight:bold">加、减、乘、除</span>运算

      ```mysql
      SELECT sal*1.5 FROM emp;
      SELECT sal+comm FROM emp;
      ```

    * 字符串类型可以做<span style="color:red;font-weight:bold">连续运算</span>

      ```mysql
      SELECT CONCAT('$', sal) FROM emp;
      ```

    * <span style="color:red;font-weight:bold">转换NULL值</span>

      ```mysql
      SELECT IFNULL(comm, 0)+1000 FROM emp;//如果comm中存在NULL值，那么当成0来运算
      ```

    * <span style="color:red;font-weight:bold">给列起别名</span>

      ```mysql
      SELECT IFNULL(comm, 0)+1000 AS 奖金 FROM emp;//AS可以省略
      ```

* <span style="color:red;font-weight:bold">条件控制</span>

  * <span style="color:red;font-weight:bold">条件查询(WHERE)</span>

    ```mysql
    SELECT empno,ename,sal,comm FROM emp WHERE sal > 10000 AND comm IS NOT NULL;
    SELECT empno,ename,sal FROM emp WHERE sal BETWEEN 20000 AND 30000;
    SELECT empno,ename,job FROM emp WHERE job IN ('经理', '董事长');
    ```

  * <span style="color:red;font-weight:bold">模糊查询(LIKE)</span>

    * <span style="color:red;font-weight:bold">_匹配一个任意字符</span>

      ```mysql
      SELECT * FROM emp WHERE ename LIKE '张_';/*姓张，名字由两个字组成的员工*/
      SELECT * FROM emp WHERE ename LIKE '___'; /*姓名由3个字组成的员工*/
      ```

    * <span style="color:red;font-weight:bold">%匹配0~N个任意字符</span>

      ```mysql
      SELECT * FROM emp WHERE ename LIKE '张%';/*查询的是姓张的所有员工*/
      SELECT * FROM emp WHERE ename LIKE '%阿%';/*查询姓名中间带有阿字的员工*/
      SELECT * FROM emp WHERE ename LIKE '%';/*条件不存在，如果姓名为NULL的查询不出来*/
      ```

### 2.3.2 排序(ORDER BY..*SC)

* <span style="color:red;font-weight:bold">升序(ORDER BY...ASC)</span>

  ```mysql
  SELECT * FROM WHERE emp ORDER BY sal ASC;//ASC是可以省略的
  ```

* <span style="color:red;font-weight:bold">降序(ORDER BY...DESC)</span>

  ```mysql
  SELECT * FROM WHERE emp ORDER BY comm DESC;//DESC不能省略
  ```

* 多列作为排序条件

  ```mysql
  SELECT * FROM WHERE emp ORDER BY sal ASC, comm DESC;//sal升序排，如果sal相同，comm降序排
  ```

### 2.3.3 聚合函数(列的纵向运算)

* <span style="color:red;font-weight:bold">COUNT</span>

  ```mysql
  SELECT COUNT(*) FROM emp;//计算emp表中所有列都不为NULL的记录的行数
  SELECT COUNT(comm) FROM emp;//计算emp表中comm列不为NULL的记录的行数
  ```

* <span style="color:red;font-weight:bold">MAX</span>

  ```mysql
  SELECT MAX(sal) FROM emp;//查询最高工资
  ```

* <span style="color:red;font-weight:bold">MIN</span>

  ```mysql
  SELECT MIN(sal) FROM emp;//查询最低工资
  ```

* <span style="color:red;font-weight:bold">SUM</span>

  ```mysql
  SELECT SUM(sal) FROM emp;//查询工资合计
  ```

* <span style="color:red;font-weight:bold">AVG</span>

  ```mysql
  SELECT AVG(sal) FROM emp;//查询平均工资
  ```

### 2.3.4 分组查询(GROUP BY)

* **记录使用某一列进行<span style="color:red;font-weight:bold">分组(GROUP BY)</span>，然后查询组信息**

  ```mysql
  SELECT deptno, COUNT(*) FROM emp GROUP BY deptno;//deptno分组，查询部门编号和每个部门记录
  SELECT job, MAX(SAL) FROM emp GROUP BY job;//使用job分组，查询每种工作的最高工资
  ```

* <span style="color:red;font-weight:bold">组条件(HAVING)</span>

  ```mysql
  SELECT deptno, COUNT(*) FROM emp GROUP BY deptno HAVING COUNT(*) > 3;
  //以部门分组，查询每组记录数。条件为记录数大于3
  ```

### 2.3.5 limit子句(方言)

* LIMIT用来限定查询结果的**起始行**，以及**总行数**

  ```mysql
  /*1. 一页的记录数：10行;2. 查询第3页*/
  select * from emp limit 20, 10;
  /* (当前页-1) * 每页记录数*/
  ```







## 2.6 练习

* **找出奖金高于工资60%的员工**

  ```mysql
  SELECT * FROM emp
  WHERE COMM>SAL*0.6;
  ```

* 找出部门编号10所有经理，部门编号20中所有销售员，即不是经理又不是销售员但其工资大或等于20000的...

  ```mysql
  select * from emp
  where (DEPTNO=10 AND JOB='经理') OR (DEPTNO=20 AND JOB='销售员') OR (JOB NOT IN('经理','销售员') AND SAL>=20000);
  ```

* 查询2000年入职的员工

  ```mysql
  select * from emp
  WHERE HIREDATE LIKE '2002%';
  ```

* 查询所有员工详细信息，用工资降序排序，如果工资相同使用入职日期升序排序

  ```mysql
  select * from emp
  order by SAL desc,HIREDATE ASC;
  ```

* 查询每种工作的最高工资、最低工资、平均工资、人数

  ```mysql
  select JOB,AVG(SAL) 平均工资,MAX(SAL) AS 最高工资,MIN(SAL)最低工资,COUNT(*) 人数 from emp
  group by JOB;
  ```














